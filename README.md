
# Automated Reconstruction of a 1000-Piece Jigsaw Puzzle

### Segmentation â€¢ Feature Extraction â€¢ Adjacency Graph â€¢ Puzzle Assembly

**Authors:** Kgetja Bruce Mphekgwane (2593733), Ivy Chepkwony (2431951)

---

## ğŸ“˜ Project Overview

This project reconstructs a **1000-piece jigsaw puzzle** automatically from raw images of puzzle pieces.
The full pipeline consists of:

1. **Segmentation** â€” Predicting masks for the 500 unlabelled pieces using a trained U-Net.
2. **Adjacency Graph Construction** â€” Determining pairwise compatibility to produce a structured graph (`graph.json`).
3. **Puzzle Assembly** â€” Using placements derived from the graph to assemble the final puzzle (`final.png`).

All training has already been completed; this submission contains **inference-only code**, as required, but re-training can be done using the segment.py file if needed. 

---

## ğŸ“‚ Directory Structure (submitted repository)

```
.
â”œâ”€â”€ run.sh                    # Main inference pipeline 
â”œâ”€â”€ requirements.txt          # Python dependencies
â”‚
â”œâ”€â”€ inference.py              # Runs U-Net segmentation inference
â”œâ”€â”€ build_graph.py            # Builds adjacency graph using masks + features_emb.pkl
â”œâ”€â”€ assemble.py               # Reconstructs final puzzle image, but requires cropped puzzle pieces to do so. 
â”‚
â”œâ”€â”€ extract_features.py       # feature extraction script
â”œâ”€â”€ embedding.py              # embedding computation script that builds vector + applies PCA
â”œâ”€â”€ matching.py               # Matching classes for the building the graph
â”œâ”€â”€ visulalize_graph.py       # Visualizes the graph.json
â”‚
â”œâ”€â”€ outputs/
     â””â”€â”€ test_features.pkl        # Output from extract_features and used in embedding.py
     â””â”€â”€ features_emb.pkl         # Precomputed per-piece features (used by build_graph.py) after embedding + PCA
â””â”€â”€ models/
     â””â”€â”€ unet_best.pth        # Trained segmentation model
```

---

## ğŸ“¥ External Directories Expected 
NOTE: Dataset in `data/` folder not included

```
./data/images/    # All 1000 puzzle piece images
./data/masks/     # 500 labelled masks (the remaining 500 must be predicted)
```


---

## â–¶ï¸ How to Run the Full Pipeline

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
bash run.sh
```

This will generate:

* `./data/pred_masks.png` â€” predicted masks for unlabelled pieces
* `graph.json` â€” final structured adjacency graph

---


### `./outputs/visuals/` â€” Visualisation & Graph Inspection Artifacts

This directory contains visual outputs generated by the graphâ€visualisation pipeline:

* **`graph_overview.png`** â€“ NetworkX overview of the full adjacency graph (nodes coloured by piece type, edges representing reciprocal matches).
* **`graph_export.gexf` / `graph_export.graphml`** â€“ Exported graph formats for interactive inspection in tools such as **Gephi** or **Cytoscape**.
* **`adjacency_list.json`** â€“ A simplified mapping from each piece ID to its neighbouring pieces based on reciprocal matching.
* **`match_*.jpg`** â€“ Matched-edge overlay images. Each image displays two candidate neighbouring pieces side-by-side with:

  * cropped bounding boxes,
  * highlighted matched edges,
  * reprojected contour points,
  * zoom-in insets,
  * similarity score.

These files are generated by running:

```bash
python visualize_graph.py \
    --graph outputs/graph_emb.json \
    --features outputs/features_emb.pkl \
    --out_dir outputs/visuals \
    --overlay_matches 50
```
